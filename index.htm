<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Iceland' rel='stylesheet' type='text/css'>
	<style type="text/css">
	body , input { font-family: 'Iceland', cursive; }
	
	h1, h2 { margin:0; padding:0; }
	h1 { font-size:3em; }
	
	
	#background { overflow:hidden; height:99%; width: 99%; position:absolute;}
	#background>ul>li { border: solid 1px #ddd; display:block; position:absolute; }
	.button { border: solid 2px #0f0 !important; cursor: pointer; }
	.button:hover { background-color:#0f0;}
	
	#mission-select ul li { margin:5px; border: solid 2px #fff }
	
	.content { display:none; padding: 0 5px; }
	.content.nopad { padding: 0; }
	
	#team-panel ul { margin: 0; padding: 0; }
	#team-panel ul li { float:left; border:solid 1px #000; height:55px; cursor: move; width: 228px; }
	#team-panel .op-list { padding-left: 2px; }
	#team-panel .op-list li { float:left; height:37px; width: 43px; }
	#team-panel .selected { background-color: orange; border-color:red }
	#weapon li { float:left; height:39px; width: 39px; }
	#mini-map { clear:both; height: 260px; width: 230px; overflow:hidden; }
	#mini-map .person-marker { border-radius:10px; width: 3px; height:3px; background-color:#0f0; display:block; position:absolute; }
	#mini-map .rescue-marker { background-color:#00f; }
	</style>
</head>
<body>
<!-- 
	http://www.freesound.org/people/dcsimon/sounds/139979/
	44 Magnum.wav
	dcsimon
-->
	<section id="main">
		<div id="background">
			<ul>
				<li id="game-title">
					<div class="content">
						<h1>The Distant Future</h1>
						<h2>The Year 2000</h2>
					</div>
				</li>
				<li id="story">
					<div class="content">
						<p>It is the distant future, the year 2000. The world's governments have fallen, and countries are now owned and run by ruthless corporations, who are constantly warring over territories.</p>
						<p>Wars are fought from office cubicles, with commanders remotely operating teams of cyborg operatives which are dispatched around the world to fight rival corporation's operatives.</p>
						<p>Login below to begin. </p>
					</div>
				</li>
				<li id="instructions">
					<div class="content">
						<h2>Controls</h2>
						<p>Guide your operatives through the streets- <strong>LEFT CLICK</strong> to move and <strong>RIGHT CLICK</strong> to shoot!</p>
						<p>If you need to you can split your team into smaller teams who can move independently- use the team manager on the left while in game.</p>
						<p>Follow the waves on your mini map to guide to your objectives.</p>
						<p><strong>Tip:</strong> Try to draw the enemies into the open where they will be in view of the satellites as we only have limited visibility.</p>
					</div>
				</li>
				<li id="logon">
					<div class="content">
						Enter Your Name : 
						<input id="txt-name" type="text" maxlength="10" />
					</div>
				</li>
				<li id="commander">
					<div class="content">
						Commander <span id="commander-label"></span> Logged In
					</div>
				</li>
				<li id="logon-button">
					<div class="content">
						Logon
					</div>
				</li>
				<li id="briefing-title">
					<div class="content">
						Briefing
					</div>
				</li>
				<li id="briefing">
					<div class="content">
						Briefing
					</div>
				</li>
				<li id="briefing-start-button">
					<div class="content">
						Start Mission
					</div>
				</li>
				<li id="briefing-back-button">
					<div class="content">
						Back To Mission Selection
					</div>
				</li>
				<li id="briefing-map-title">
					<div class="content">
						Tactical Map
					</div>
				</li>
				<li id="briefing-map">
					<div class="content nopad">
						<canvas id="tactical-map" width="290" height="230" ></canvas>	
					</div>
				</li>
				<li id="mission-select-title">
					<div class="content">
						Select Mission
					</div>
				</li>
				<li id="mission-select">
					<div class="content">
						<ul>
						</ul>
					</div>
				</li>
				<li id="game">
					<div class="content nopad">
						<canvas id="tehCanvas" width="650" height="530" ></canvas>
					</div>
				</li>
				<li id="game-map">
					<div class="content nopad">
						<canvas id="mini-map" width="230" height="260" ></canvas>	
					</div>
				</li>
				<li id="game-team-panel">
					<div class="content nopad" id="team-panel">
						
					</div>
				</li>
				<li id="game-objective">
					<div class="content nopad">
						<marquee id="objective-display">Establishing Satellite Uplink...</marquee>
					</div>
				</li>
				<li id="summary-title">
					<div class="content">
						Mission Summary
					</div>
				</li>
				<li id="summary-detail">
					<div class="content">
						Mission Summary
					</div>
				</li>
				<li id="mission-time">
					<div class="content">
						<span id="timeText"></span>
					</div>
				</li>
			</ul>
		</div>
	</section>
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script src="layout-manager.js"></script>
	
	<script src="http://code.createjs.com/easeljs-0.5.0.min.js"></script>
	<script src="http://code.createjs.com/tweenjs-0.3.0.min.js"></script>
	<script src="http://code.createjs.com/soundjs-0.3.0.min.js"></script>
	<script src="http://code.createjs.com/preloadjs-0.2.0.min.js"></script>
	<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
	<script src="game-classes.js"></script>
	<script src="game-main.js"></script>
	
	<script>
     //$(function () {

         var tactical_map = null;
         var game_instance = null;

         var missions = [
             {
                 Name: 'Brighton - Shopping Precinct, UK',
                 BaseImage: 'brighton.jpg',
                 MapSize: [1549, 875],
                 LevelDefinition: [[[1, [[784, 332], [733, 438], [504, 393], [555, 286]]], [3, [[495, 665], [510, 673], [571, 683], [615, 684], [634, 678], [646, 660], [722, 463], [479, 414], [472, 427], [524, 436], [648, 462], [612, 541], [563, 531]]], [4, [[1141, 209], [1081, 344], [916, 310], [907, 300], [905, 282], [960, 173]]], [5, [[1294, 376], [1123, 346], [1177, 215], [1334, 243]]], [6, [[1461, 259], [1423, 398], [1329, 384], [1363, 245]]], [38, [[1548, 752], [1536, 750], [1531, 744], [1532, 703], [1496, 691], [1485, 679], [1474, 664], [1474, 646], [1472, 632], [1548, 488]]], [70, [[826, 286], [819, 299], [796, 296], [804, 282]]], [71, [[328, 263], [284, 261], [287, 254], [327, 256]]], [72, [[460, 276], [462, 284], [506, 277], [504, 270]]], [76, [[133, 266], [91, 265], [93, 252], [50, 247], [49, 243], [10, 239], [8, 229], [48, 231], [52, 240], [94, 241], [97, 255], [135, 256]]], [77, [[577, 212], [530, 179], [481, 128], [472, 115], [456, 85], [442, 48], [428, 22], [409, 0], [646, 0], [631, 82], [616, 161], [608, 188], [591, 211]]], [79, [[876, 165], [826, 227], [767, 260], [725, 269], [677, 267], [666, 257], [693, 184], [720, 133], [732, 78], [739, 0], [955, 0], [924, 88], [898, 136], [877, 144]]], [80, [[503, 234], [497, 249], [475, 258], [0, 216], [0, 0], [332, 0], [382, 70], [342, 84], [496, 218]]], [83, [[0, 342], [393, 409], [372, 451], [510, 477], [508, 498], [413, 702], [610, 739], [610, 758], [573, 875], [0, 875]]], [84, [[1407, 0], [1375, 204], [1443, 213], [1464, 77], [1506, 83], [1480, 213], [1487, 218], [1487, 223], [1549, 227], [1549, 0]]], [85, [[1340, 202], [1387, 0], [1210, 0], [1193, 168], [1228, 171], [1246, 85], [1325, 95], [1303, 196]]], [86, [[1549, 429], [1535, 430], [1533, 422], [1472, 406], [1495, 307], [1549, 310]]], [87, [[1178, 0], [1158, 158], [976, 128], [1028, 0]]], [89, [[1501, 875], [1508, 838], [1504, 764], [1470, 708], [1378, 678], [1198, 647], [1151, 715], [1117, 763], [1097, 806], [1083, 875]]], [91, [[1517, 467], [1446, 579], [1407, 636], [1193, 594], [776, 517], [855, 344]]], [92, [[767, 549], [1163, 622], [1121, 680], [1097, 701], [1066, 732], [1032, 875], [661, 875]]], [93, [[284, 308], [313, 311], [301, 332], [273, 329]]], [94, [[88, 276], [115, 279], [101, 299], [78, 297]]], [95, [[339, 305], [430, 308], [423, 321], [385, 319], [331, 326]]]], [[12, [[1082, 341], [1030, 331], [1027, 328], [994, 321], [989, 324], [939, 313], [938, 304], [911, 302], [904, 290], [905, 268], [901, 264], [901, 253], [903, 242], [911, 218], [922, 198], [919, 178], [927, 163], [941, 165], [939, 119], [955, 89], [984, 88], [1016, 97], [1016, 122], [1027, 124], [1032, 114], [1106, 125], [1106, 150], [1140, 159], [1143, 191], [1143, 208]]], [13, [[1294, 377], [1124, 345], [1124, 295], [1183, 157], [1219, 161], [1231, 150], [1246, 154], [1270, 155], [1295, 163], [1301, 182], [1306, 176], [1322, 181], [1332, 189], [1334, 200], [1334, 234]]], [14, [[1331, 384], [1423, 399], [1466, 240], [1467, 201], [1432, 194], [1432, 198], [1409, 197], [1410, 189], [1376, 187], [1375, 197], [1370, 199], [1363, 220], [1361, 234], [1342, 302], [1336, 308], [1332, 323]]], [19, [[1053, 116], [1031, 113], [1027, 125], [1016, 123], [1015, 98], [984, 89], [952, 89], [959, 77], [964, 65], [974, 51], [979, 46], [983, 30], [990, 13], [992, 3], [993, 1], [1070, 0]]], [20, [[1303, 172], [1316, 110], [1324, 70], [1345, 62], [1366, 78], [1347, 190], [1342, 206], [1337, 206], [1330, 188], [1319, 180], [1307, 177]]], [23, [[783, 331], [733, 437], [720, 436], [720, 420], [665, 412], [663, 414], [640, 407], [639, 408], [620, 408], [617, 400], [613, 404], [596, 401], [592, 395], [588, 398], [565, 393], [511, 384], [510, 351], [519, 334], [531, 331], [532, 293], [554, 257], [558, 255], [559, 243], [569, 238], [576, 243], [576, 251], [599, 241], [600, 236], [607, 229], [612, 232], [615, 237], [618, 240], [667, 250], [667, 267], [688, 270], [716, 276], [730, 257], [782, 266]]], [24, [[717, 264], [670, 262], [669, 248], [657, 244], [656, 209], [663, 198], [678, 189], [677, 167], [687, 145], [696, 142], [697, 112], [701, 103], [702, 97], [702, 55], [706, 47], [704, 39], [709, 31], [712, 24], [716, 14], [722, 4], [724, 1], [750, 1], [724, 263]]], [25, [[245, 235], [448, 258], [479, 258], [497, 252], [504, 235], [500, 179], [467, 173], [467, 176], [296, 166], [245, 187]]], [26, [[477, 173], [454, 144], [430, 133], [420, 127], [413, 109], [385, 89], [377, 90], [370, 74], [327, 90], [315, 110], [318, 126], [351, 156], [371, 150], [365, 167]]], [27, [[383, 71], [381, 14], [370, 2], [309, 2], [296, 7], [293, 12], [295, 77], [326, 88], [369, 72], [372, 74]]], [30, [[1490, 516], [1513, 484], [1517, 469], [1517, 446], [1477, 439], [1471, 442], [1428, 432], [1425, 420], [1381, 413], [1380, 399], [1375, 404], [1367, 404], [1365, 397], [1304, 391], [1189, 371], [1143, 368], [1143, 360], [1086, 349], [1075, 367], [1059, 364], [1058, 359], [1030, 351], [1026, 331], [993, 324], [989, 328], [986, 338], [941, 329], [938, 314], [930, 308], [856, 292], [832, 334], [821, 367], [805, 396], [806, 404], [799, 415], [795, 417], [775, 465], [774, 502], [787, 501], [791, 497], [795, 504], [801, 504], [881, 374]]], [31, [[1547, 274], [1506, 268], [1480, 351], [1477, 391], [1472, 402], [1471, 407], [1534, 421], [1534, 430], [1548, 432]]], [33, [[719, 469], [718, 422], [666, 414], [665, 417], [642, 409], [619, 410], [617, 403], [613, 406], [595, 403], [591, 397], [588, 400], [497, 382], [484, 401], [505, 405], [509, 438], [523, 442], [557, 447]]], [34, [[637, 458], [626, 479], [625, 511], [579, 507], [577, 505], [572, 503], [571, 497], [555, 493], [549, 506], [549, 515], [540, 536], [540, 549], [529, 571], [522, 572], [515, 583], [507, 583], [494, 609], [496, 652], [495, 660], [501, 671], [510, 678], [531, 684], [536, 668], [582, 677], [594, 673], [603, 677], [606, 684], [609, 689], [623, 688], [634, 682]]], [35, [[1, 289], [20, 291], [35, 299], [60, 297], [78, 300], [91, 309], [109, 307], [127, 308], [145, 317], [157, 315], [176, 316], [195, 324], [214, 322], [234, 325], [248, 332], [270, 331], [289, 335], [303, 342], [316, 340], [337, 341], [365, 349], [376, 340], [390, 336], [401, 335], [411, 339], [411, 348], [413, 359], [412, 387], [430, 382], [446, 386], [448, 392], [482, 397], [481, 401], [504, 407], [507, 490], [2, 461]]], [47, [[1164, 611], [1163, 589], [1155, 582], [1153, 576], [1131, 573], [1125, 583], [1066, 576], [1062, 573], [1060, 557], [1052, 544], [1042, 543], [1030, 550], [1024, 557], [1021, 562], [1010, 562], [973, 560], [971, 543], [949, 538], [943, 536], [930, 544], [928, 548], [894, 544], [892, 542], [873, 539], [873, 536], [857, 533], [857, 516], [851, 508], [839, 509], [837, 506], [830, 506], [827, 512], [808, 510], [803, 507], [793, 505], [791, 500], [787, 502], [767, 505], [763, 504], [758, 511], [752, 524], [750, 537], [753, 557], [742, 563], [736, 566], [731, 584], [735, 586], [731, 596]]], [48, [[729, 597], [700, 686], [695, 708], [693, 731], [684, 744], [677, 762], [664, 795], [658, 804], [654, 823], [648, 872], [736, 874], [791, 600]]], [49, [[1548, 460], [1511, 533], [1506, 536], [1476, 592], [1472, 646], [1476, 669], [1492, 687], [1530, 698]]], [50, [[1504, 748], [1496, 711], [1482, 692], [1476, 678], [1469, 671], [1459, 671], [1456, 667], [1453, 670], [1452, 674], [1445, 674], [1444, 680], [1427, 671], [1423, 664], [1414, 656], [1415, 638], [1382, 623], [1353, 616], [1353, 613], [1302, 602], [1296, 608], [1277, 603], [1270, 608], [1265, 608], [1255, 605], [1243, 607], [1235, 626], [1218, 626], [1207, 612], [1198, 609], [1190, 636], [1172, 656], [1167, 665], [1168, 683], [1140, 679], [1119, 710], [1117, 726], [1105, 744], [1105, 781]]], [51, [[1114, 787], [1104, 786], [1102, 780], [1095, 774], [1093, 781], [1093, 789], [1074, 797], [1066, 836], [1069, 842], [1065, 860], [1069, 863], [1067, 871], [1177, 872], [1176, 793]]], [57, [[825, 286], [818, 300], [795, 296], [800, 283], [799, 269], [801, 264], [802, 246], [804, 240], [806, 234], [810, 228], [814, 232], [818, 239], [819, 268], [821, 267], [822, 281]]], [58, [[506, 278], [462, 285], [460, 264], [504, 258]]], [59, [[329, 263], [283, 262], [284, 247], [286, 241], [329, 244]]], [60, [[136, 268], [88, 266], [93, 248], [138, 249]]], [61, [[98, 234], [47, 235], [47, 248], [100, 250]]], [62, [[50, 221], [6, 218], [8, 238], [52, 241]]], [63, [[885, 167], [894, 169], [895, 179], [879, 209], [866, 209], [867, 197]]], [64, [[908, 188], [897, 221], [883, 250], [883, 262], [895, 265], [903, 234], [920, 194], [920, 190]]], [65, [[316, 323], [316, 309], [306, 300], [288, 298], [275, 303], [269, 312], [275, 322], [273, 329], [300, 334], [305, 333]]], [66, [[81, 295], [80, 285], [75, 279], [83, 272], [99, 270], [124, 275], [121, 285], [113, 296], [90, 301], [81, 299]]], [69, [[438, 131], [434, 121], [417, 102], [410, 104], [420, 127], [437, 134]]], [96, [[598, 789], [611, 759], [609, 690], [604, 689], [600, 677], [593, 676], [577, 680], [537, 671], [526, 701], [515, 698], [509, 689], [506, 698], [409, 683], [378, 743], [378, 765]]]], [], [{ "type": 0, "position": [411, 49], "facing": "S" }, { "type": 5, "position": [606, 825], "facing": "S" }, { "type": 99, "position": [1437, 397], "facing": "S" }, { "type": 1, "position": [1128, 252], "facing": "S" }, { "type": 1, "position": [970, 138], "facing": "S" }, { "type": 1, "position": [863, 199], "facing": "S" }, { "type": 1, "position": [682, 432], "facing": "S" }, { "type": 1, "position": [820, 530], "facing": "S" }, { "type": 1, "position": [1178, 609], "facing": "S" }, { "type": 1, "position": [383, 259], "facing": "S" }, { "type": 1, "position": [640, 118], "facing": "S" }, { "type": 1, "position": [493, 557], "facing": "S" }, { "type": 1, "position": [1323, 296], "facing": "S"}]],
                 Briefing: '<p>Enemy agents have moved into the abandoned district of Brighton on the south coast of the UK killing all friendly operatives and leaving one of our generals pinned down and in hiding in the south.</p><p>Intel suggests enemy forces have since moved out on other engagements leaving the region only lightly defended.  You are to deploy your team in the north, and work your way down to find the trapped agent at the southern most point of the region and get him to the extraction point at the far east, unharmed.  Beware, he has been trapped for some time and is quite eager to get out so may run ahead, so you may have to split you team to send an advanced party ahead of the group protecting the payload to clear out any hostiles along the path ahead.</p>',
                 Highlight: { x: 650, y: 850 },
                 Music: 'music1'
             },
             {
                 Name: 'Brighton - Omnitron HQ, UK',
                 BaseImage: 'brighton2.jpg',
                 MapSize: [1570, 1091],
                 LevelDefinition: [[[0, [[207, 0], [207, 14], [69, 193], [0, 181], [0, 0]]], [1, [[431, 78], [273, 40], [0, 400], [161, 446]]], [3, [[650, 51], [809, 84], [733, 194], [573, 164]]], [4, [[901, 521], [1042, 544], [1260, 165], [1130, 142]]], [5, [[245, 445], [256, 473], [410, 488], [473, 439], [514, 387], [747, 457], [723, 523], [819, 537], [1065, 135], [843, 90], [735, 265], [474, 192], [466, 211], [429, 199]]], [6, [[514, 53], [535, 59], [465, 162], [443, 158]]], [7, [[1285, 0], [1221, 129], [531, 13], [531, 0]]], [8, [[1313, 0], [1246, 127], [1400, 151], [1471, 0]]], [9, [[1570, 59], [1494, 40], [1447, 147], [1534, 169]]], [10, [[1262, 416], [1322, 441], [1233, 596], [1099, 580], [1319, 168], [1387, 184], [1370, 220], [1347, 219], [1248, 400]]], [11, [[1306, 410], [1398, 434], [1429, 388], [1336, 363]]], [12, [[1542, 633], [1419, 624], [1313, 607], [1286, 592], [1345, 487], [1466, 527], [1452, 560], [1570, 588]]], [13, [[1226, 1091], [1371, 683], [1570, 719], [1570, 1091]]], [14, [[1180, 662], [1314, 686], [1159, 1091], [1015, 1091]]], [15, [[1570, 236], [1472, 214], [1458, 252], [1551, 274]]], [16, [[1550, 343], [1530, 380], [1543, 393], [1531, 417], [1470, 398], [1508, 329]]], [17, [[0, 480], [40, 510], [0, 570]]], [18, [[0, 647], [92, 501], [182, 518], [0, 810]]], [20, [[226, 517], [465, 553], [171, 1091], [0, 1091], [0, 897]]], [21, [[509, 562], [758, 591], [652, 805], [739, 827], [757, 778], [722, 765], [795, 596], [879, 611], [664, 1052], [460, 990], [553, 817], [528, 806], [422, 1019], [523, 1059], [510, 1091], [230, 1091]]], [22, [[841, 1091], [771, 1072], [865, 882], [936, 898]]], [23, [[945, 631], [1144, 659], [1127, 717], [1101, 712], [1055, 836], [1071, 840], [1056, 879], [857, 827]]]], [[24, [[844, 1091], [769, 1071], [776, 890], [822, 809], [828, 804], [831, 791], [870, 708], [951, 730], [940, 894]]], [25, [[879, 613], [880, 584], [801, 569], [729, 741], [732, 763], [755, 766]]], [26, [[761, 595], [762, 543], [621, 515], [601, 551], [596, 601], [512, 764], [546, 769]]], [27, [[603, 822], [605, 793], [585, 780], [555, 781], [458, 959], [461, 993], [480, 993]]], [28, [[1147, 673], [1146, 632], [1044, 615], [1038, 627], [958, 613], [932, 623], [896, 698], [895, 712], [943, 724]]], [29, [[1398, 434], [1305, 410], [1307, 394], [1297, 391], [1312, 264], [1339, 224], [1365, 228], [1370, 216], [1420, 228], [1429, 237], [1429, 247], [1449, 257], [1435, 383]]], [30, [[413, 77], [413, 15], [373, 0], [303, 0], [280, 36], [254, 30], [246, 22], [234, 27], [160, 122], [167, 131], [168, 191]]], [31, [[253, 439], [256, 397], [331, 301], [350, 306], [351, 293], [359, 283], [404, 298], [291, 448]]], [32, [[281, 531], [285, 518], [308, 498], [334, 494], [397, 510], [405, 516], [417, 516], [423, 512], [456, 516], [469, 534], [451, 559]]], [33, [[268, 520], [266, 502], [248, 489], [227, 495], [175, 574], [98, 705], [0, 855], [0, 930]]], [35, [[182, 519], [181, 502], [175, 497], [117, 486], [81, 499], [0, 616], [0, 686]]], [36, [[588, 573], [586, 557], [559, 552], [557, 536], [544, 515], [530, 522], [524, 513], [504, 525], [444, 629], [436, 627], [425, 644], [421, 676], [406, 687], [404, 695], [394, 714], [391, 734], [367, 777], [361, 778], [353, 793], [357, 794], [352, 804], [349, 803], [343, 815], [295, 903], [289, 903], [281, 915], [287, 917], [279, 936], [285, 947], [271, 960], [200, 1091], [267, 1091], [536, 572]]], [37, [[1462, 244], [1464, 220], [1475, 201], [1570, 226], [1548, 266]]], [38, [[1457, 147], [1461, 118], [1472, 93], [1498, 52], [1517, 51], [1523, 38], [1556, 31], [1485, 155]]], [39, [[1388, 184], [1391, 160], [1338, 150], [1331, 165], [1324, 158], [1309, 167], [1117, 505], [1116, 524], [1110, 525], [1102, 537], [1103, 558], [1101, 575], [1140, 584], [1327, 221]]], [40, [[1258, 166], [1261, 144], [1202, 127], [1145, 116], [1130, 140], [1117, 140], [913, 478], [913, 512], [964, 509]]], [41, [[1057, 138], [1059, 110], [1045, 99], [1032, 102], [1021, 96], [1010, 99], [997, 96], [992, 103], [872, 75], [844, 84], [844, 94], [837, 116], [830, 141], [814, 145], [807, 155], [816, 163], [829, 169], [1050, 153]]], [42, [[813, 77], [796, 72], [740, 60], [733, 65], [728, 63], [725, 57], [690, 45], [679, 43], [641, 33], [634, 50], [629, 65], [780, 82]]], [45, [[281, 277], [281, 262], [275, 262], [273, 249], [100, 203], [0, 339], [0, 400], [67, 392], [272, 291]]], [46, [[826, 292], [831, 225], [797, 191], [640, 150], [606, 160], [603, 164], [597, 163], [534, 246], [410, 212], [360, 270], [361, 283], [403, 296], [401, 321], [806, 322]]], [47, [[1549, 341], [1554, 318], [1538, 305], [1511, 309], [1491, 348], [1488, 372], [1528, 382]]], [48, [[1501, 503], [1504, 483], [1512, 473], [1570, 489], [1570, 547], [1513, 531]]], [49, [[1287, 589], [1290, 565], [1325, 513], [1352, 476], [1357, 467], [1378, 473], [1377, 480], [1388, 480], [1391, 454], [1396, 456], [1393, 482], [1400, 484], [1407, 473], [1473, 490], [1470, 519], [1462, 539], [1570, 571], [1570, 591], [1540, 637], [1431, 609], [1426, 623], [1325, 608], [1294, 597]]], [50, [[1313, 678], [1305, 646], [1286, 631], [1247, 631], [1226, 627], [1204, 631], [1185, 626], [1169, 656], [1168, 675], [1148, 726], [1221, 721]]], [51, [[1151, 784], [1136, 777], [1120, 777], [1095, 838], [1093, 859], [1112, 862]]], [52, [[1086, 937], [1057, 947], [1005, 1091], [1053, 1091], [1109, 956]]], [54, [[1570, 695], [1551, 688], [1529, 690], [1528, 673], [1375, 645], [1365, 669], [1362, 685], [1353, 692], [1346, 720], [1320, 792], [1267, 944], [1260, 945], [1253, 966], [1258, 969], [1250, 985], [1242, 1003], [1226, 1064], [1220, 1064], [1209, 1091], [1289, 1091]]], [55, [[1092, 860], [1085, 875], [1078, 897], [1076, 903], [1073, 915], [1063, 929], [1058, 946], [1086, 936], [1117, 864]]], [56, [[623, 506], [626, 499], [637, 489], [630, 475], [617, 480], [609, 475], [600, 469], [584, 476], [584, 471], [587, 467], [575, 463], [573, 471], [567, 473], [566, 478], [574, 479], [568, 494], [574, 487], [576, 491], [578, 495], [583, 491], [589, 498], [593, 506], [604, 501], [614, 501], [618, 494]]], [57, [[532, 484], [545, 479], [542, 474], [548, 469], [547, 459], [532, 450], [521, 452], [515, 458], [507, 461], [506, 469], [508, 479], [512, 486], [522, 486]]], [58, [[480, 482], [486, 478], [495, 468], [490, 459], [478, 463], [481, 456], [480, 447], [467, 440], [451, 444], [442, 440], [421, 445], [419, 460], [419, 470], [436, 473], [441, 484], [448, 486], [463, 486], [472, 487]]], [59, [[1504, 458], [1519, 451], [1516, 437], [1487, 434], [1455, 426], [1434, 421], [1415, 417], [1406, 432], [1414, 442], [1446, 445], [1479, 453]]], [60, [[1457, 201], [1457, 181], [1439, 176], [1424, 181], [1423, 196], [1415, 204], [1425, 210], [1440, 210], [1447, 212]]], [61, [[604, 32], [620, 27], [624, 20], [605, 12], [588, 17], [586, 26]]], [63, [[458, 141], [459, 130], [477, 105], [484, 87], [491, 78], [501, 65], [507, 50], [522, 46], [532, 57], [471, 145]]], [64, [[694, 813], [701, 803], [716, 793], [723, 788], [741, 791], [753, 799], [741, 833], [694, 825]]], [65, [[1544, 428], [1546, 414], [1532, 412], [1529, 429]]], [66, [[1446, 387], [1449, 371], [1455, 353], [1440, 344], [1436, 382], [1432, 390], [1447, 395]]]], [], [{ "type": 0, "position": [694, 1045], "facing": "S" }, { "type": 1, "position": [218, 428], "facing": "S" }, { "type": 1, "position": [528, 420], "facing": "S" }, { "type": 1, "position": [645, 450], "facing": "S" }, { "type": 1, "position": [809, 543], "facing": "S" }, { "type": 1, "position": [1075, 115], "facing": "S" }, { "type": 1, "position": [509, 24], "facing": "S" }, { "type": 1, "position": [522, 156], "facing": "S" }, { "type": 1, "position": [440, 486], "facing": "S" }, { "type": 1, "position": [687, 515], "facing": "S" }, { "type": 1, "position": [821, 68], "facing": "S" }, { "type": 1, "position": [999, 586], "facing": "S" }, { "type": 1, "position": [893, 455], "facing": "S" }, { "type": 1, "position": [1093, 489], "facing": "S" }, { "type": 1, "position": [577, 514], "facing": "S" }, { "type": 99, "position": [1528, 185], "facing": "S" }, { "type": 6, "position": [593, 424], "facing": "S"}]],
                 Briefing: '<p>Intel suggests an important general is visiting one of the enemies key facilities-  he must be assassinated.</p><p>Deploy to the area and head north towards the large central building- He is generally wearing heavy body armour which may make him harder to dispatch than the normal operatives, but also far less mobile.  Once assassinated, move to the extraction in the north east.</p>',
                 Highlight: { x: 600, y: 400 },
                 Music: 'music2'
             },
             {
                 Name: 'Sydney - Waverton Harbour, AUS',
                 BaseImage: 'sydney_harbour.jpg',
                 MapSize: [1606, 1852],
                 LevelDefinition: [[[3, [[1156, 1852], [1144, 1737], [1150, 1664], [1040, 1689], [1022, 1852]]], [5, [[1606, 1426], [1280, 1604], [1202, 1663], [1185, 1717], [1202, 1852], [1606, 1852]]], [6, [[1606, 1391], [1295, 1542], [1351, 1445], [1412, 1375], [1489, 1289], [1481, 1227], [1397, 1178], [1327, 1112], [1325, 1037], [1389, 969], [1404, 877], [1606, 796]]], [7, [[1265, 888], [1120, 914], [1088, 848], [1067, 849], [1003, 725], [1186, 685], [1242, 799], [1242, 799], [1229, 806]]], [8, [[1537, 826], [1346, 598], [1286, 602], [1164, 449], [1023, 152], [921, 0], [1606, 0], [1606, 797]]], [9, [[1166, 634], [1124, 639], [1119, 631], [1010, 651], [977, 578], [940, 582], [877, 456], [1078, 423]]], [10, [[1026, 361], [876, 384], [848, 316], [816, 319], [800, 271], [779, 255], [774, 238], [779, 196], [766, 147], [930, 118], [953, 173]]], [14, [[804, 1852], [814, 1671], [1036, 1662], [1153, 1634], [1250, 1519], [1317, 1405], [1391, 1337], [1417, 1275], [1382, 1226], [1313, 1181], [1268, 1119], [1259, 1072], [1310, 938], [1350, 915], [1356, 869], [1345, 834], [1234, 697], [1230, 723], [1321, 856], [1322, 889], [1279, 946], [1226, 959], [1135, 1057], [1083, 975], [990, 1036], [970, 1022], [1071, 951], [980, 766], [930, 735], [257, 1137], [215, 1109], [884, 709], [690, 366], [108, 702], [70, 677], [667, 330], [605, 209], [672, 171], [754, 0], [0, 0], [0, 1852]]], [28, [[712, 377], [891, 694], [913, 678], [893, 629], [844, 541], [830, 500], [762, 401], [746, 380], [728, 371]]], [30, [[1260, 657], [1357, 621], [1536, 826], [1429, 873]]]], [[15, [[1145, 1697], [1150, 1684], [1147, 1668], [1113, 1654], [1094, 1658], [1080, 1674], [1082, 1688], [1085, 1704]]], [16, [[1320, 1500], [1320, 1488], [1319, 1469], [1317, 1451], [1332, 1447], [1349, 1453], [1355, 1457]]], [17, [[1405, 1255], [1407, 1231], [1388, 1204], [1354, 1212], [1333, 1223]]], [18, [[1344, 1201], [1347, 1187], [1368, 1186], [1349, 1162], [1331, 1146], [1314, 1149], [1304, 1155], [1291, 1149], [1282, 1167], [1283, 1189]]], [19, [[1367, 995], [1358, 980], [1348, 968], [1334, 971], [1332, 994], [1337, 1009], [1326, 1023], [1315, 1031], [1314, 1049], [1315, 1090], [1316, 1119], [1341, 1143], [1373, 1180], [1402, 1199], [1425, 1215], [1458, 1231], [1479, 1231], [1480, 1221]]], [20, [[1365, 972], [1366, 940], [1352, 934], [1341, 935], [1334, 948], [1338, 976], [1356, 983]]], [21, [[1263, 891], [1267, 847], [1246, 798], [1246, 764], [1182, 648], [1133, 643], [1086, 649], [1044, 662], [1017, 671], [1002, 677], [1006, 728], [1027, 784], [1227, 896]]], [22, [[1165, 630], [1168, 623], [1166, 609], [1159, 593], [1158, 579], [1162, 572], [1106, 442], [1107, 424], [1102, 410], [1090, 410], [1066, 358], [876, 385], [879, 457], [902, 504], [1133, 638]]], [23, [[1027, 358], [1032, 302], [993, 213], [973, 213], [975, 174], [971, 161], [957, 163], [958, 146], [919, 55], [770, 77], [772, 132], [773, 152], [781, 182]]], [24, [[1198, 1699], [1179, 1707], [1176, 1741], [1181, 1768], [1176, 1779], [1176, 1790], [1172, 1811], [1173, 1852], [1218, 1852]]], [25, [[1407, 903], [1388, 902], [1378, 919], [1373, 954], [1407, 959]]], [26, [[1413, 876], [1402, 863], [1397, 841], [1405, 831], [1421, 833], [1433, 854], [1431, 874]]], [27, [[1335, 819], [1347, 807], [1336, 787], [1330, 773], [1322, 765], [1303, 779], [1302, 764], [1311, 751], [1296, 738], [1279, 726], [1267, 755], [1313, 816]]], [31, [[1259, 665], [1243, 646], [1235, 624], [1250, 600], [1273, 603], [1327, 596], [1331, 599], [1353, 597], [1374, 629], [1285, 696]]]], [], [{ "type": 0, "position": [950, 1775], "facing": "S" }, { "type": 99, "position": [919, 1780], "facing": "S" }, { "type": 1, "position": [105, 662], "facing": "S" }, { "type": 1, "position": [127, 646], "facing": "S" }, { "type": 1, "position": [191, 609], "facing": "S" }, { "type": 1, "position": [223, 595], "facing": "S" }, { "type": 1, "position": [246, 580], "facing": "S" }, { "type": 1, "position": [164, 629], "facing": "S" }, { "type": 1, "position": [249, 1093], "facing": "S" }, { "type": 1, "position": [269, 1088], "facing": "S" }, { "type": 1, "position": [350, 1036], "facing": "S" }, { "type": 1, "position": [358, 1036], "facing": "S" }, { "type": 1, "position": [371, 1025], "facing": "S" }, { "type": 1, "position": [523, 938], "facing": "S" }, { "type": 1, "position": [557, 926], "facing": "S" }, { "type": 1, "position": [598, 878], "facing": "S" }, { "type": 1, "position": [627, 867], "facing": "S" }, { "type": 1, "position": [574, 897], "facing": "S" }, { "type": 1, "position": [751, 798], "facing": "S" }, { "type": 1, "position": [766, 784], "facing": "S" }, { "type": 1, "position": [795, 762], "facing": "S" }, { "type": 1, "position": [667, 287], "facing": "S" }, { "type": 1, "position": [711, 357], "facing": "S" }, { "type": 1, "position": [654, 352], "facing": "S" }, { "type": 1, "position": [923, 666], "facing": "S" }, { "type": 1, "position": [952, 722], "facing": "S" }, { "type": 1, "position": [1082, 919], "facing": "S" }, { "type": 1, "position": [1191, 559], "facing": "S" }, { "type": 1, "position": [1192, 589], "facing": "S" }, { "type": 1, "position": [888, 409], "facing": "S" }, { "type": 1, "position": [1038, 392], "facing": "S" }, { "type": 1, "position": [788, 118], "facing": "S" }, { "type": 1, "position": [909, 90], "facing": "S" }, { "type": 1, "position": [967, 123], "facing": "S" }, { "type": 1, "position": [1256, 683], "facing": "S" }, { "type": 1, "position": [1357, 912], "facing": "S" }, { "type": 1, "position": [1229, 664], "facing": "S" }, { "type": 1, "position": [1132, 655], "facing": "S"}]],
                 Briefing: '<p>Enemy ships have been spotted at a harbour in Australia, and satellite surveillance has shown operative activity in the area- it looks like they are preparing to ship out to attack new region.</p><p>Your team will be dispatched south of the harbour and you are to proceed north and elimate all enemy agents.</p>',
                 Highlight: { x: 600, y: 400 },
                 Music: 'music2'
             }
         ];

         var selected_mission = 0;

         var anim_speed = 800;

         setupMissionList();

         fillWithBoxes();

         var name = readCookie('name');
         if (name != null) {
             $('#commander-label').text(name);
             name = null;
         }

         var gotoscreen = getQueryString()["goto"];
         if (typeof (gotoscreen) !== 'undefined') {
             MoveToScreen(gotoscreen);
             gotoscreen = null;
         }
         else {
             MoveToScreen('logon');
         }

         function setupMissionList() {
             var html = '';

             for (var i = 0; i < missions.length; i++) {
                 html += '<li data-index="' + i + '">' + missions[i].Name + '</li>';
             }

             $('#mission-select .content ul')
                 .empty()
                 .append(html);

             html = null;
         }

         function fillWithBoxes() {
             var lis = '';
             for (var i = 0; i < 100; i++)
                 lis += '<li></li>';

             $('#background>ul').append(lis);

             // randomise the li's
         }

         function setupTacticalMap() {
             tactical_map = new MiniMapCanvas(missions[selected_mission].LevelDefinition[CONST.AreaType.Blocked], undefined, missions[selected_mission].MapSize, missions[selected_mission].MapSize, [290, 230], 'tactical-map', 1);
             tactical_map.Init();
             tactical_map.AddExtraction(missions[selected_mission].Highlight.x, missions[selected_mission].Highlight.y, 50);
             tactical_map.Update();
         }

         function bringFocus(objects, callback) {

             var layout_manager = new LayoutManager(30, 60);
             var units = 30;

             $('.fixed').removeClass('fixed');
             $('.content').hide();

             var to_animate = 0,
                 animated = 0;

             if (typeof (objects) !== 'undefined') {
                 for (var i = 0; i < objects.length; i++) {
                     var coords = layout_manager.forcePosition(objects[i].x, objects[i].y, objects[i].w - 1, objects[i].h - 1)

                     to_animate++;

                     $('#' + objects[i].id).addClass('fixed').animate({
                         height: (units * objects[i].h) - 10 + 'px',
                         width: (units * objects[i].w) - 10 + 'px',
                         'margin-top': (coords.y * units) + 'px',
                         'margin-left': coords.x * units + 'px'
                     },
                     {
                         duration: anim_speed,
                         easing: 'easeInOutQuint',
                         complete: function () {
                             animated++;
                         }
                     });
                     $('.content', '#' + objects[i].id).show();
                 }
             }

             $('#background>ul>li:not(.fixed)').each(function (i, ele) {

                 to_animate++;

                 var size = 0;
                 var real_size = units;
                 switch (parseInt(Math.random() * 5)) {
                     case 3:
                         size = 1;
                         real_size = units * 2;
                         break;
                     case 4:
                         size = 2;
                         real_size = units * 3;
                         break;
                 }
                 var free_space = layout_manager.findFreeSpace(size, size);

                 $(this).animate({
                     height: real_size - 10 + 'px',
                     width: real_size - 10 + 'px',
                     'margin-top': (free_space.y * units) + 'px',
                     'margin-left': free_space.x * units + 'px'
                 },
                 {
                     duration: anim_speed,
                     easing: 'easeInOutQuint',
                     complete: function () {
                         animated++;
                         //console.log(to_animate + '/' + animated);
                         if (to_animate == animated && typeof (callback) !== 'undefined') {
                             callback();
                         }
                     }
                 });

                 size = null;
                 real_size = null;
                 free_space = null;
             });
             layout_manager = null;
         }

         function MoveToScreen(screen) {

             $('.button')
                 .removeClass('button')
                 .off('click');

             switch (screen) {
                 case 'logon':

                     $('#commander-label').text('');

                     bringFocus([
                         { id: 'game-title', w: 14, h: 3, x: 5, y: 2 },
                         { id: 'story', w: 15, h: 6, x: 5, y: 5 },
                         { id: 'logon', w: 6, h: 2, x: 10, y: 11 },
                         { id: 'logon-button', w: 3, h: 2, x: 16, y: 11 },
                         { id: 'instructions', w: 9, h: 11, x: 20, y: 2 },
                     ], function () {
                         $('#logon-button')
                             .addClass('button')
                             .on('click', function () {
                                 $('#commander-label').text($('#txt-name').val());
                                 MoveToScreen('mission-select');
                                 createCookie('name', $('#txt-name').val(), 30);
                             });
                     });
                     break;
                 case 'mission-select':
                     bringFocus([
                         { id: 'commander', w: 10, h: 1, x: 19, y: 0 },
                         { id: 'mission-select-title', w: 11, h: 1, x: 9, y: 2 },
                         { id: 'mission-select', w: 12, h: 8, x: 9, y: 3 }
                     ], function () {
                         $('#mission-select .content ul li')
                             .addClass('button')
                             .on('click', function () {
                                 selected_mission = $(this).data('index');
                                 MoveToScreen('mission-details');
                             });
                     });
                     break;
                 case 'mission-details':
                     bringFocus([
                         { id: 'commander', w: 10, h: 1, x: 19, y: 0 },
                         { id: 'briefing-title', w: 15, h: 1, x: 12, y: 1 },
                         { id: 'briefing', w: 16, h: 10, x: 12, y: 2 },
                         { id: 'briefing-start-button', w: 3, h: 2, x: 9, y: 10 },
                         { id: 'briefing-back-button', w: 3, h: 2, x: 2, y: 10 },
                         { id: 'briefing-map-title', w: 9, h: 1, x: 2, y: 1 },
                         { id: 'briefing-map', w: 10, h: 8, x: 2, y: 2 },
                         { id: 'instructions', w: 26, h: 7, x: 2, y: 12 },
                     ], function () {

                         $('#briefing .content').html(missions[selected_mission].Briefing); // load the mission details, only after the animation is finished...

                         $('#briefing-start-button')
                             .addClass('button')
                             .on('click', function () {
                                 MoveToScreen('game');
                             });

                         $('#briefing-back-button')
                             .addClass('button')
                             .on('click', function () {
                                 $('#briefing .content').html('');
                                 MoveToScreen('mission-select');
                             });

                         setupTacticalMap();

                     });
                     break;
                 case 'game':
                     bringFocus([
                         { id: 'commander', w: 10, h: 1, x: 19, y: 0 },
                         { id: 'game', w: 22, h: 18, x: 8, y: 1 },
                         { id: 'game-map', w: 8, h: 9, x: 0, y: 10 },
                         { id: 'game-team-panel', w: 8, h: 8, x: 0, y: 1 },
                         { id: 'game-objective', w: 8, h: 1, x: 0, y: 9 },
                         { id: 'mission-time', w: 8, h: 1, x: 0, y: 0 }
                     ], function () {

                         game_instance = new Game({
                             canvasId: 'tehCanvas',
                             miniMapId: 'mini-map',
                             teamPanelId: 'team-panel',
                             miniMapDimensions: [230, 260],
                             objectiveDisplayId: 'objective-display',
                             levelDefinition: missions[selected_mission].LevelDefinition,
                             baseImage: missions[selected_mission].BaseImage,
                             timePanelId: 'timeText',
                             Music: missions[selected_mission].Music,
                             onEndGame: function (data) {
                                 $('li').css({ 'background-color': '', 'color': '', 'font-weight': '' });

                                 // setup summary screen

                                 var mission_status = (data.Success ? 'Succeeded' : 'Failed');

                                 var numminutes = Math.floor((((data.TotalSeconds % 31536000) % 86400) % 3600) / 60);
                                 var numseconds = (((data.TotalSeconds % 31536000) % 86400) % 3600) % 60;
                                 var mission_time = numminutes + ':' + numseconds;
                                 var html = '<h2>Mission ' + mission_status + '</h2> <ul>'
                                 html += '<li>Enemy Operative Neutralised : ' + data.EnemiesKIA + '/' + data.Enemies + '</li>';
                                 html += '<li>Payloads Rescued : ' + data.Rescued + '/' + data.ToRescue + '</li>';
                                 html += '<li>Assassination Targets Dispatched : ' + data.AssassinationTargetsKIA + '/' + data.AssassinationTargets + '</li>';
                                 html += '<li>Team Casualties : ' + data.PlayerOperativesKIA + '</li>';
                                 html += '</ul>';
                                 $('#summary-detail .content').html(html);

                                 html = null;
                                 mission_time = null;
                                 numseconds = null;
                                 numminutes = null;
                                 mission_status = null;
                                 data = null;
                                 game_instance = null;

                                 MoveToScreen('summary');
                             }
                         });
                     });
                     break;
                 case 'summary':
                     bringFocus([
                         { id: 'summary-title', w: 11, h: 1, x: 9, y: 2 },
                         { id: 'summary-detail', w: 12, h: 8, x: 9, y: 3 },
                         { id: 'briefing-back-button', w: 3, h: 2, x: 9, y: 11 },
                         { id: 'mission-time', w: 8, h: 1, x: 13, y: 11 }
                     ], function () {

                         $('#briefing-back-button')
                             .addClass('button')
                             .on('click', function () {
                                 $('#briefing .content').html('');
                                 MoveToScreen('mission-select');
                                 //window.location = 'http://codeblog.shawson.co.uk/storage/the-distant-future/index.htm?goto=mission-select';
                             });

                     });
             }
         }

         function createCookie(name, value, days) {
             if (days) {
                 var date = new Date();
                 date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                 var expires = "; expires=" + date.toGMTString();
             }
             else var expires = "";
             document.cookie = name + "=" + value + expires + "; path=/";
         }

         function readCookie(name) {
             var nameEQ = name + "=";
             var ca = document.cookie.split(';');
             for (var i = 0; i < ca.length; i++) {
                 var c = ca[i];
                 while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                 if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
             }
             return null;
         }

         function eraseCookie(name) {
             createCookie(name, "", -1);
         }

         function getQueryString() {
             var result = {}, queryString = location.search.substring(1),
               re = /([^&=]+)=([^&]*)/g, m;

             while (m = re.exec(queryString)) {
                 result[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
             }

             return result;
         }

     //});
	</script>
	
</body>
</html>